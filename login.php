<?php
require_once('signatures.php');
$con = mysqli_connect("localhost", 'root', '', 'db' );

		if($_FILES && !empty($_POST['malwareName'])) {
			$name = $_FILES['filename']['name'];
			move_uploaded_file($_FILES['filename']['tmp_name'],$name);
			
			switch($_FILES['filename']['type']) {
			case '':
				echo "need a file";
			
			break;
			default :
					//$malware= substr($name, 0, strpos($name, '.')); 
					$malName = $_POST['malwareName'];
					$signature = signature_hex($name, 20) ;
					//insertMalware($con, $signature, $malware);
					insertMalware($con, $signature, $malName);
					
			break;
			}
		}
		
		//inserts malware into database
		function insertMalware($conn , $signature , $malwareName) {
			$query = "Select * from common_signatures where `malware`= '$malwareName' 
			and `signature`='$signature'" ;
			$result = mysqli_query($conn, $query);
			$numRows= mysqli_num_rows($result);
			if($numRows>0) {
				echo "malware is already in the database";
			} else {
				$query = "insert into `common_signatures`(malware, signature) 
				values ('$malwareName','$signature')";
				$result = mysqli_query($conn, $query);
				echo "malware is now in database";
			}
		}
		
		
	
		
		
?>